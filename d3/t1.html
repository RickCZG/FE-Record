<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <style>
    .footprint {
        stroke: red;
    }
    .tick line[stroke-dasharray] {
        opacity: 0.3;
    }
    .footprint-circle {
        fill: aqua;
        opacity: 0.3;
    }
    .column {
        fill: orange;
    }
    </style>
</head>
<body>
<script type="text/javascript" src="./moment.js"></script>
<script type="text/javascript" src="./d3.min.js"></script>
<script type="text/javascript">
var svgwidth = 800;
var svgheight = 500;
var svg = d3.select("body").append("svg")
    .attr("width", svgwidth)
    .attr("height", svgheight)
    var margin = {top: 20, right: 0, bottom: 20, left: 0},
    width = +svg.attr("width") - margin.left - margin.right,
    height = +svg.attr("height") - margin.top - margin.bottom,
    g = svg.append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    
var formatNumber = d3.format(".1f");

var x = d3.scaleTime()
    .domain([new Date(2010, 7, 1), new Date(2010, 7, 10)])
    .range([20, width-20]);

var y = d3.scaleLinear()
    .domain([0, 24])
    .range([height, 0]);

var xAxis = d3.axisBottom(x)
    .ticks(d3.timeDay)
    .tickFormat(function(d){
        return moment(d).format("MM-DD")
    });

var yAxis = d3.axisRight(y)
    .tickSize(width)
    .tickFormat(function(d) {
        return d
    });





(function(){
    var start = +new Date(2010, 7, 1)
    var end = +new Date(2010, 7, 16)
    var dist = end - start
    var list = []
    for (var i = 0; i<100; i++){
        list.push({
            date: start + Math.floor(dist*Math.random())
        })
    }
    window.data = list.sort(function(a, b){
        return a.date > b.date ? 1 : -1
    })
    // console.log(list)
})()

// var data = [
//     {
//         date: 1280631600000
//     },
//     {
//         date: 1280635200000
//     }
// ]

function date2day(d){
    var dayt = d%86400000;
    var h = dayt/(1000*60*60)
    return y(h)
}
function date2hour(d){
    var date = new Date(d)
    var newD = new Date(date.getFullYear(), date.getMonth(), date.getDate());
    // console.log(newD, date)
    return x(newD)
}

// console.log(data.map(function(d) { return (d.date); }))

var startTime = new Date(data[0].date);
startTime.setDate(  startTime.getDate() - 1)
x.domain([startTime, new Date(data[data.length - 1].date)]);


g.append("g")
    .attr("transform", "translate(0," + height + ")")
    .call(customXAxis)
    // .selectAll(".tick")
    // .append("rect")
    //     .attr("transform", "translate(-10, 0)")
    //     .attr("class", "column")
    //     .attr("x", 0)
    //     .attr("y", -height)
    //     .attr("width", 20)
    //     .attr("height", height)

g.append("g")
    .call(customYAxis);


g.append("g")
    .attr("transform", "translate(-5, 0)")
    .selectAll(".line")
      .data(data)
      .enter().append("line")
      .attr("data-d", function(d){
          return d.date
      })
      .attr("class", "footprint")
      .attr("x1", function(d){
          return date2hour(d.date)
      })
      .attr("x2", function(d){
          return date2hour(d.date) + 10
      })
      .attr("y1", function(d){
          return height - date2day(d.date)
      })
      .attr("y2", function(d){
          return height - date2day(d.date)
      })

// g.append("g")
//     // .attr("transform", "translate(-5, 0)")
//     .selectAll(".img")
//       .data(data)
//       .enter().append("image")
//       .attr("class", "footprint-img")
//       .attr("data-d", function(d){
//           return d.date
//       })
//       .attr("x", function(d){
//           return date2hour(d.date)
//       })
//       .attr("y", function(d){
//           return height - date2day(d.date)
//       })

//       .attr("xlink:href", "foot.png")
//       .attr("width", 20)
//       .attr("height", 34)

// g.append("g")
//     .selectAll(".circle")
//       .data(data)
//       .enter().append("circle")
//       .attr("class", "footprint-circle")
//       .attr("data-d", function(d){
//           return d.date
//       })
//       .attr("cx", function(d){
//           return date2hour(d.date)
//       })
//       .attr("cy", function(d){
//           return height - date2day(d.date)
//       })
//       .attr("r", 5)

function customXAxis(g) {
  g.call(xAxis);
  g.select(".domain").remove();
}

function customYAxis(g) {
  g.call(yAxis);
  g.select(".domain").remove();
  g.selectAll(".tick:not(:first-of-type) line").attr("stroke", "#777").attr("stroke-dasharray", "2,2");
  g.selectAll(".tick text").attr("x", 4).attr("dy", -4);
}
</script>
</body>
</html>